---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '@/layouts/BaseLayout.astro';
import { Card, CardHeader, CardTitle, CardDescription, CardContent } from '@/components/ui/card';

const allPosts = await getCollection('blog');
const { searchParams } = Astro.url;
const selectedTag = searchParams.get('tag');
const posts = selectedTag
  ? allPosts.filter((post: CollectionEntry<'blog'>) => post.data.tags?.includes(selectedTag as string))
  : allPosts;
---

<Layout>
  <div class="flex flex-col items-center w-full">
    <h1 class="text-4xl font-bold mt-40 mb-10">Blog</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 w-full max-w-5xl justify-items-center">
      {posts.map((post: CollectionEntry<'blog'>) => (
    <Card className="w-full max-w-xs flex flex-col h-full min-h-[200px]">
    <CardHeader>
        <CardTitle>
        <a href={`/blog/${post.slug}`} class="hover:underline font-medium">
            {post.data.title}
        </a>
        </CardTitle>
        <CardDescription>{post.data.summary}</CardDescription>
    </CardHeader>
    <div class="flex-grow"/>
    <CardContent>
        <div class="text-sm text-gray-500 mb-2">{post.data.date}</div>
        <div class="flex flex-wrap gap-2 mb-2">
        {post.data.tags?.map((tag) => (
            <span class="bg-blue-100 text-blue-700 rounded px-2 py-0.5 text-xs">{tag}</span>
        ))}
        </div>
    </CardContent>
    </Card>
      ))}
    </div>
  </div>
</Layout> 